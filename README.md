# Tank Battle Simulator - 3D симулятор танковых боев с ИИ

Симулятор танковых боев с использованием генетического алгоритма для обучения танков через эволюцию.

## Возможности

- ✅ 3D визуализация боев в реальном времени
- ✅ Генетический алгоритм для эволюции ИИ танков
- ✅ Нейронная сеть для управления танками
- ✅ Два режима камеры: вид сверху и от 3-го лица
- ✅ Возможность управлять танком вручную
- ✅ Генерация случайных карт с препятствиями
- ✅ Система команд и подсчета статистики
- ✅ Сохранение и загрузка лучших геномов

## Установка и запуск

### Требования
- Rust 1.70+
- Cargo

### Запуск
```bash
cargo run --release
```

Для разработки (быстрая компиляция, но медленнее работает):
```bash
cargo run
```

## Управление

### Общее управление
- **Tab** - переключение между видом сверху и от 3-го лица
- **Стрелки** - перемещение камеры (в режиме вида сверху)
- **+/-** - приближение/отдаление камеры
- **ЛКМ** - выбор танка для просмотра от 3-го лица

### Управление танком (если активировано ручное управление)
- **W** - движение вперед
- **S** - движение назад
- **A** - поворот влево
- **D** - поворот вправо
- **Пробел** - выстрел

## Архитектура проекта

```
src/
├── main.rs           # Главный файл, инициализация Bevy
├── components.rs     # ECS компоненты (Tank, Projectile, AI, etc.)
├── systems.rs        # Игровые системы (движение, стрельба, коллизии)
├── ai.rs             # Нейронная сеть для управления танками
├── genetics.rs       # Генетический алгоритм (селекция, мутация, скрещивание)
├── battle.rs         # Система боев и управление поколениями
├── map.rs            # Генерация игровых карт
├── camera.rs         # Системы управления камерой
└── ui.rs             # Пользовательский интерфейс
```

## Как работает генетический алгоритм

1. **Инициализация**: Создается популяция из 20 танков со случайными весами нейронной сети
2. **Оценка**: Танки сражаются друг с другом, накапливая фитнес (убийства, время выживания)
3. **Селекция**: Отбираются лучшие 20% танков (элитизм)
4. **Скрещивание**: Создаются новые танки путем комбинирования генов родителей
5. **Мутация**: Случайные изменения в геномах для разнообразия
6. **Повторение**: Процесс повторяется для следующего поколения

## Нейронная сеть

Архитектура: 8 входов → 8 скрытых нейронов → 4 выхода

### Входы:
1. Здоровье танка (нормализованное)
2. Расстояние до ближайшего врага
3-4. Направление к врагу (X, Z)
5-6. Угол к врагу (sin, cos)
7. Здоровье врага
8. Текущий угол поворота танка

### Выходы:
1. Движение вперед/назад
2. Поворот влево/вправо
3. Стрельба
4. (Резерв)

## Фитнес-функция

```
fitness = убийства × 100 + время_выживания × 2
```

## Расширение функционала

### Добавление ручного управления танком

В файле `battle.rs` измените функцию `spawn_initial_tanks`:
```rust
// Вместо AI добавьте PlayerControlled
commands.entity(tank_entity).insert(PlayerControlled);
```

### Бой между разными поколениями

Сохраните лучшие геномы разных поколений и загрузите их:
```rust
// В battle.rs уже есть заготовка функции setup_generation_battle
```

### Настройка параметров эволюции

В `genetics.rs` можно изменить:
- `mutation_rate` (0.1) - вероятность мутации гена
- `mutation_strength` (0.3) - сила мутации
- `tournament_size` (3) - размер турнира для селекции
- `elite_count` - количество элитных особей

## Сохранение прогресса

Лучшие геномы автоматически сохраняются в `best_genomes.json` после каждого поколения.

## Планы развития

- [ ] Улучшенная нейронная сеть (больше слоев, LSTM)
- [ ] Различные типы танков (быстрые, тяжелые, снайперы)
- [ ] Режим наблюдения за эволюцией в ускоренном времени
- [ ] Визуализация нейронной сети
- [ ] Статистика и графики эволюции
- [ ] Мультиплеер
- [ ] Редактор карт

## Технологии

- **Bevy 0.12** - игровой движок
- **Rand** - генерация случайных чисел
- **Serde** - сериализация данных

## Лицензия

MIT

## Автор

Создано с помощью Rust + Bevy для изучения генетических алгоритмов и игрового ИИ.
